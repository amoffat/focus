<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Focus.py by amoffat</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Focus.py</h1>
        <p>Because the internet is distracting.</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/amoffat/focus" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/amoffat/focus/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/amoffat/focus/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <p>Focus.py helps you keep focused by applying schedulable firewall rules
to distracting websites.  An example firewall rule looks like this:</p>

<div class="highlight">
<pre><span class="k">def</span> <span class="nf">domain_reddit_com</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span> <span class="o">==</span> <span class="mi">21</span> <span class="c"># allow from 9-10pm</span>
</pre>
</div>


<h1>Starting</h1>

<h3>Linux</h3>

<p>Add the following line to the top of your <code>/etc/resolv.conf</code>, <em>before</em> any
other nameservers:</p>

<pre><code>nameserver 127.0.0.1
</code></pre>

<h3>Mac OS X</h3>

<p>Go to <code>System Preferences -&gt; Network -&gt; Advanced -&gt; DNS</code> and add <code>127.0.0.1</code>
as your DNS server.</p>

<hr><p>Now start Focus:</p>

<pre><code>sudo python focus.py &amp;
</code></pre>

<h1>Filtering Domains</h1>

<p>Firewall rules involving schedules and timeframes can get complicated fast.
For this reason, the scheduling specification is pure Python, so you can make
your filtering rules as simple or as complex as you want.</p>

<p>The default filter rules is created on first startup in <code>/etc/focus_blacklist.py</code>:</p>

<div class="highlight">
<pre><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">domain_ycombinator_com</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="c"># return dt.hour % 2 # every other hour</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">domain_reddit_com</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="c"># return dt.hour in (12, 21) # at noon-1pm, or from 9-10pm</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">domain_facebook_com</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="c"># do something with regular expressions here?</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre>
</div>


<p>The format is simple; Just define a function named like the domain you
want to block, preceeded by "domain_".  Have it take a single datetime object
and have it return True or False.  In the body, you can write whatever logic
makes the most sense for
you.  Maybe you want to write your own Pomodoro routine, or maybe you want to
scrape your google calendar for exam dates, and block certain websites on those dates.</p>

<p>For sites without their own scheduler function, the default() function is called.</p>

<p>There's no need to restart Focus if you redefine your schedules.</p>

<h1>Configuration</h1>

<p>Focus.py tries to start with a sensible configuration, but if you need to change
it, edit <code>/etc/focus.json.conf</code></p>

<h1>How it works</h1>

<p>Focus.py is, at its core, a DNS server.  By making it your primary nameserver,
it receives all DNS lookup requests.  Based on the domain name being requested,
it either responds with a "fail ip" address (blocked), or passes the request
on to your other nameservers (not blocked).  In both cases, Focus adjusts the TTL of each
DNS response so that the service requesting the DNS lookup will do minimal
caching on the IP, allowing Focus's filtering rules to be more immediate.</p>

<h1>FAQ</h1>

<ul>
<li>Q: I started Focus, but it's not blacklisting the site I picked.</li>
<li><p>A: Your browser may be caching that site's ip.  Give it a few minutes.</p></li>
<li><p>Q: Why do I need to start Focus with sudo?</p></li>
<li><p>A: Focus needs to listen on a privileged port as a DNS server.</p></li>
<li><p>Q: How do I stop Focus?</p></li>
<li><p>A: Focus writes its process id to /var/run/focus.py.pid.  Kill the process using this process id.</p></li>
</ul>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/amoffat">amoffat</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-31477907-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>